name: Generar index.json para artículos

on:
  push:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Clonar repositorio
        uses: actions/checkout@v3

      - name: Configurar Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Instalar gray-matter
        run: npm install gray-matter

      - name: Generar index.json
        run: |
          node <<'EOF'
          const fs = require('fs');
          const path = require('path');
          const matter = require('gray-matter');

          const folder = 'articulos';
          const files = fs.readdirSync(folder);
          const articles = [];

          files.forEach(file => {
            if (file.endsWith('.md')) {
              const content = fs.readFileSync(path.join(folder, file), 'utf8');
              const { data } = matter(content);
              articles.push({
                title: data.title || '',
                category: data.category || '',
                excerpt: data.excerpt || '',
                image: data.image || '',
                slug: file.replace(/\.md$/, '')
              });
            }
          });

          fs.writeFileSync('articulos/index.json', JSON.stringify(articles, null, 2));
          EOF

      - name: Commit y push del index.json
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add articulos/index.json
          git commit -m "Generar index.json automáticamente"
          git push
